"use strict";(()=>{var e={};e.id=772,e.ids=[772],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},91211:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>H,requestAsyncStorage:()=>R,routeModule:()=>A,serverHooks:()=>U,staticGenerationAsyncStorage:()=>b});var i={};r.r(i),r.d(i,{GET:()=>g,POST:()=>C});var n=r(49303),d=r(88716),a=r(60670),s=r(91585),o=r(5754),c=r(9846),u=r(38553),h=r(91941),l=r(46526),I=r(28633),p=r(90542),w=r(92891),y=r(47833);let f={church:{select:{id:!0,name:!0,districtId:!0}},_count:{select:{attendance:!0}}},m=(e,t)=>{if("UNION_ADMIN"!==e.role){if("DISTRICT_ADMIN"===e.role){if(!e.districtId)throw new y.lY("No district assigned to this account");if(t.districtId&&t.districtId!==e.districtId)throw new y.lY("Cannot view sessions outside your district");return}if("CHURCH_ADMIN"===e.role){if(!e.churchId)throw new y.lY("No church assigned to this account");if(t.churchId&&t.churchId!==e.churchId)throw new y.lY("Cannot view sessions outside your church");return}throw new y.lY("Not allowed to view sessions")}},D=async(e,t={})=>{m(e,t);let r={};return t.districtId&&(r.church={districtId:t.districtId}),t.churchId&&(r.churchId=t.churchId),"DISTRICT_ADMIN"!==e.role||t.districtId||(r.church={districtId:e.districtId??void 0}),"CHURCH_ADMIN"!==e.role||t.churchId||(r.churchId=e.churchId??void 0),p.g.findMany({where:r,include:f,orderBy:{date:"desc"}})},_=async(e,t)=>{if("CHURCH_ADMIN"!==e.role)throw new y.lY("Only church admins can create sessions");if(!e.churchId)throw new y.lY("No church assigned to this account");let r=await w.d.findById(e.churchId,{where:{id:e.churchId},select:{id:!0}});if(!r)throw new y.dR("Church not found");return p.g.create({data:{churchId:r.id,date:t.date,theme:t.theme,createdById:e.id},include:f})},N=async e=>({sessions:await D(e.user,e.queryData??{})}),q=async e=>{if(!e.body)throw new y.p8("Missing request body");let t=(0,I.Z)(e.body.date);if(Number.isNaN(t.getTime()))throw new y.p8("Invalid session date");let r={date:t,theme:e.body.theme};return{session:await _(e.user,r)}},v=s.Ry({districtId:s.Z_().optional(),churchId:s.Z_().optional()}),M=s.Ry({date:s.Z_().min(1,"Date is required"),theme:s.Z_().optional().nullable()}),g=(0,o.o)({middlewares:[(0,c.k)(["UNION_ADMIN","DISTRICT_ADMIN","CHURCH_ADMIN"]),(0,h.i)(v),(0,l.J$)({optional:!0}),(0,l.Dy)({optional:!0})],controller:N}),C=(0,o.o)({middlewares:[(0,c.k)(["CHURCH_ADMIN"]),(0,u.m)(M),(0,l.Dy)({key:"churchId",optional:!0})],controller:q}),A=new n.AppRouteRouteModule({definition:{kind:d.x.APP_ROUTE,page:"/api/sessions/route",pathname:"/api/sessions",filename:"route",bundlePath:"app/api/sessions/route"},resolvedPagePath:"/Volumes/Macintosh HD - Data/sda/sda-backend/app/api/sessions/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:R,staticGenerationAsyncStorage:b,serverHooks:U}=A,x="/api/sessions/route";function H(){return(0,a.patchFetch)({serverHooks:U,staticGenerationAsyncStorage:b})}},46526:(e,t,r)=>{r.d(t,{Dy:()=>u,J$:()=>c});var i=r(13538),n=r(47833);let d=async(e,t)=>{let r=await i._.district.findUnique({where:{id:t},include:{union:!0}});if(!r)throw new n.dR("District not found");if("UNION_ADMIN"===e.role||"DISTRICT_ADMIN"===e.role&&e.districtId===t)return r;throw new n.lY("Not allowed to access this district")},a=async(e,t)=>{let r=await i._.church.findUnique({where:{id:t},include:{district:{include:{union:!0}}}});if(!r)throw new n.dR("Church not found");if("UNION_ADMIN"===e.role||"DISTRICT_ADMIN"===e.role&&e.districtId===r.districtId||"CHURCH_ADMIN"===e.role&&e.churchId===t)return r;throw new n.lY("Not allowed to access this church")},s=(e,t)=>{let r="paramsData"in e&&e.paramsData&&"object"==typeof e.paramsData?e.paramsData[t]:void 0,i=e.params?.[t],n="queryData"in e&&e.queryData&&"object"==typeof e.queryData?e.queryData[t]:void 0,d="body"in e&&e.body&&"object"==typeof e.body?e.body[t]:void 0,a=r??i??n??d;return"string"==typeof a&&a.trim().length>0?a:void 0},o=(e,t,{optional:r}={})=>{let i=s(e,t);if(!i&&!r)throw new n.p8(`Missing or invalid identifier for ${t}`);return i},c=(e={})=>{let t=e.key??"districtId",r=e.optional??!1;return async e=>{if(!e.user)throw new n.yj("Authentication required");let i=o(e,t,{optional:r});if(!i)return{...e,district:e.district};let a=await d(e.user,i);return{...e,district:a}}},u=(e={})=>{let t=e.key??"churchId",r=e.optional??!1;return async e=>{if(!e.user)throw new n.yj("Authentication required");let i=o(e,t,{optional:r});if(!i)return{...e,church:e.church};let d=await a(e.user,i);return{...e,church:d}}}},91941:(e,t,r)=>{r.d(t,{i:()=>d});var i=r(26033),n=r(47833);let d=e=>async t=>{let r=Object.fromEntries(t.query.entries());try{let i=e.parse(r);return{...t,queryData:i}}catch(e){if(e instanceof i.jm)throw new n.p8("Invalid query parameters",e.flatten());throw e}}},92891:(e,t,r)=>{r.d(t,{d:()=>n});var i=r(13538);let n={findById:(e,t)=>i._.church.findUnique({...t??{},where:{id:e}}),findMany:e=>i._.church.findMany(e),create:e=>i._.church.create(e),update:e=>i._.church.update(e),delete:e=>i._.church.delete(e),count:e=>i._.church.count(e)}},90542:(e,t,r)=>{r.d(t,{g:()=>n});var i=r(13538);let n={findById:(e,t)=>i._.umugandaSession.findUnique({where:{id:e},...t??{}}),findMany:e=>i._.umugandaSession.findMany(e),create:e=>i._.umugandaSession.create(e),update:e=>i._.umugandaSession.update(e),delete:e=>i._.umugandaSession.delete(e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[416,585,144],()=>r(91211));module.exports=i})();